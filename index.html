<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="icon" href="https://weedoutbadreps.com/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    
    <meta property="og:title" content="Weed Out Bad Reps!" />
    <meta property="og:description" content="Hold politicians accountable for the Texas THC ban." />
    <meta property="og:image" content="https://weedoutbadreps.com/opengraph.png" />
    <meta property="og:url" content="https://weedoutbadreps.com" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Weed Out Bad Reps!" />
    <meta property="og:locale" content="en_US" />
        
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Weed Out Bad Reps!" />
    <meta name="twitter:description" content="Hold politicians accountable for the Texas THC ban." />
    <meta name="twitter:image" content="https://weedoutbadreps.com/opengraph.png" />
    
    <meta name="description" content="Hold politicians accountable for the Texas THC ban." />
    <link rel="apple-touch-icon" href="https://weedoutbadreps.com/logo192.png" />
    <title>Weed Out Bad Reps! - Hold Politicians Accountable for the Texas THC Ban</title>
    <!-- Removed duplicate meta charset and viewport -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(76, 175, 80, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(76, 175, 80, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(76, 175, 80, 0.12) 0%, transparent 50%);
            z-index: -1;
            animation: floatBackground 20s ease-in-out infinite;
        }
        
        @keyframes floatBackground {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 20px;
            transition: all 0.6s ease;
        }
        
        .hero.compact {
            min-height: auto;
            padding: 60px 20px 40px;
        }
        
        h1 {
            font-size: clamp(3rem, 9vw, 6rem);
            font-weight: 900;
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            animation: glow 2s ease-in-out infinite alternate;
            text-shadow: 0 0 40px rgba(76, 175, 80, 0.6);
        }
        
        #thc-hook {
            display: inline;
            color: #4CAF50;
            font-weight: 700;
            padding: 0 2px;
            position: relative;
            transition: opacity 0.3s ease-in-out;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px rgba(76, 175, 80, 0.5)); }
            to { filter: drop-shadow(0 0 40px rgba(76, 175, 80, 0.8)); }
        }
        
        .subtitle {
            font-size: clamp(1.3rem, 3.5vw, 2rem);
            color: #b0b0b0;
            margin-bottom: 50px;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.3s;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .search-form {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.5s;
            transition: all 0.3s ease;
            margin: 0 auto;
        }
        
        .search-form:hover {
            border-color: rgba(76, 175, 80, 0.5);
            box-shadow: 0 25px 70px rgba(76, 175, 80, 0.15);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #4CAF50;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .submit-btn {
            display: inline-block;
            background: #4CAF50;
            color: #fff;
            padding: 18px 35px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5);
        }
        
        .results {
            display: none;
            padding: 60px 20px;
            opacity: 0;
            animation: fadeIn 0.8s ease forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .rep-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .rep-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .rep-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, #4CAF50, transparent);
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .rep-card.voted-yes {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(239, 68, 68, 0.05);
        }
        
        .rep-card.voted-yes::before {
            background: linear-gradient(90deg, transparent, #ef4444, transparent);
        }
        
        .rep-card.voted-no {
            border-color: rgba(76, 175, 80, 0.4);
            background: rgba(76, 175, 80, 0.08);
        }
        
        .rep-card.did-not-vote {
            border-color: rgba(251, 191, 36, 0.3);
            background: rgba(251, 191, 36, 0.05);
        }
        
        .rep-card.did-not-vote::before {
            background: linear-gradient(90deg, transparent, #fbbf24, transparent);
        }
        
        .rep-type {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .rep-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .district {
            font-size: 16px;
            color: #888;
            margin-bottom: 20px;
        }
        
        .vote-status {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .vote-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .voted-yes .vote-status { color: #ef4444; }
        .voted-yes .vote-icon { background: #ef4444; color: white; }
        
        .voted-no .vote-status { color: #4CAF50; }
        .voted-no .vote-icon { background: #4CAF50; color: white; }
        
        .did-not-vote .vote-status { color: #fbbf24; }
        .did-not-vote .vote-icon { background: #fbbf24; color: black; }
        
        .message {
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .call-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: #4CAF50;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .call-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.5);
        }
        
        .action-section {
            background: rgba(76, 175, 80, 0.08);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-top: 50px;
        }
        
        .action-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .signup-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .signup-form .form-group {
            margin-bottom: 15px;
        }
        
        .footer {
            padding: 40px 20px;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 80px;
            font-size: 14px;
            color: #666;
        }
        
        .privacy-link {
            color: #4CAF50;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }
        
        .privacy-link:hover {
            opacity: 0.8;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(76, 175, 80, 0.2);
            border-top-color: #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-content {
            max-width: 800px;
            margin: 50px auto;
            background: #1a1a1a;
            border-radius: 20px;
            padding: 40px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: #666;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close-modal:hover {
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="hero" id="hero">
        <div class="container">
            <h1>Weed Out Bad Reps!</h1>
            <p class="subtitle">Your Texas state representatives just voted to take away your right to<br><span id="thc-hook" style="transition: opacity 0.3s ease-in-out;">safe and legal THC</span><br><br><i>How did your representatives vote?</i></p>
            
            <form class="search-form" id="searchForm">
                <div class="form-group">
                    <label for="streetAddress">Street Address</label>
                    <input type="text" id="streetAddress" placeholder="420 Main St">
                </div>
                
                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" placeholder="Austin">
                </div>
                
                <div class="form-group">
                    <label for="zip">ZIP Code <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="zip" placeholder="78701" required>
                </div>
                
                <div class="error" id="searchError"></div>
                
                <button type="submit" class="submit-btn" id="submitBtn">See How Your Reps Voted</button>
            </form>
        </div>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Finding your representatives...</p>
    </div>
    
    <div class="results" id="results">
        <div class="container">
            <div class="rep-cards" id="repCards"></div>
            
            <div class="action-section">
                <h2 class="action-title">Join the Fight to Restore Our Rights</h2>
                <p>Sign up to get updates, learn about upcoming events, and find out how you can help hold these politicians accountable.<br></p>
                
                <form id="signupForm" class="signup-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="signupEmail">Email Address</label>
                            <input type="email" id="signupEmail" name="signupEmail" placeholder="you@example.com" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPhone">Phone Number (Optional)</label>
                            <input type="tel" id="signupPhone" name="signupPhone" placeholder="(555) 123-4567">
                        </div>
                    </div>
                    <div class="error" id="signupError"></div>
                    <button type="submit" class="submit-btn" id="signupSubmitBtn">Help Us Fire These Reps</button>
                </form>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <p>Paid for by Texans for a Texan Texas PAC</p>
        <p><a href="#" class="privacy-link" id="privacyLinkFooter">Privacy Policy</a></p>
    </footer>
    
    <div class="modal" id="privacyModal">
        <div class="modal-content">
            <span class="close-modal" id="closePrivacyModal">×</span>
            <h2 style="color: #4CAF50; margin-bottom: 20px;">Privacy Policy</h2>
            <p style="line-height: 1.8; color: #ccc;">
                <strong>Texans for a Texan Texas PAC Privacy Policy</strong><br><br>
                
                <strong>Information We Collect:</strong><br>
                We collect the information you provide when using our website, including your address (street, city, zip code), email address, and phone number (if provided).<br><br>
                
                <strong>How We Use Your Information:</strong><br>
                - To identify your state representatives and senators based on the address provided.<br>
                - To provide you with information about your representatives' voting records on relevant legislation.<br>
                - If you opt-in by providing your email or phone number, to send you updates about policy reform, political campaign efforts in Texas, upcoming events, and ways to support these efforts.<br>
                - To mobilize grassroots support and fundraising for political candidates aligned with our mission.<br><br>
                
                <strong>Data Storage and Security:</strong><br>
                Your information (address, and if provided, email/phone) is stored in our secure database. We implement appropriate technical and organizational security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.<br><br>
                
                <strong>Data Sharing:</strong><br>
                We do not sell your personal information. We may share your information with trusted partners working on similar political advocacy or campaign efforts, under strict confidentiality agreements, to further our shared goals. You will be informed if such sharing specific to a campaign is to occur.<br><br>

                <strong>Your Rights:</strong><br>
                You have the right to:
                - Request access to the personal information we hold about you.
                - Request correction of any inaccurate personal information.
                - Request deletion of your personal information, subject to any legal or operational retention needs.
                To exercise these rights, please contact Texans for a Texan Texas PAC.<br><br>
                
                <strong>Contact:</strong><br>
                For questions about this privacy policy, please contact Texans for a Texan Texas PAC.
            </p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="/supabase.js"></script>
    
    <script type="module">
        import { supabase, addLead, updateLead, formatPhoneNumber } from '/supabase.js';

        let currentLeadId = null; // Stores the ID of the current lead from campaign_leads table
        let houseVotes = {};      // Initialize as an empty object
        let senateVotes = {};     // Initialize as an empty object
        
        fetch('voteValues.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                data.forEach(item => {
                    if (item.chamber === 'H') {
                        houseVotes[item.district] = item.vote;
                    } else if (item.chamber === 'S') {
                        senateVotes[item.district] = item.vote;
                    }
                });
                console.log('Vote data loaded and processed.');
            })
            .catch(error => {
                console.error('Error loading or processing vote data:', error);
                // Proceed without vote data or show error to user
                // For now, just logging, app will still function for address lookup
            });
        
        const messages = {
            1: { // Voted YES on banning THC (bad)
                house: "voted YES on SB 3 to criminalize THC and destroy 50,000 Texas jobs. They sided with Dan Patrick's extreme agenda over veterans who rely on THC for pain relief and PTSD. Now Texans face jail time for products that were legal yesterday.",
                senate: "voted YES on SB 3 to criminalize THC and destroy 50,000 Texas jobs. They sided with Dan Patrick's extreme agenda over veterans who rely on THC for pain relief and PTSD. Now Texans face jail time for products that were legal yesterday."
            },
            2: { // Voted NO on banning THC (good)
                house: "voted NO on SB 3, standing with veterans, small businesses, and 62% of Texans who support legal THC. They fought Dan Patrick's criminalization scheme that would jail patients and destroy a $1.9 billion Texas industry.",
                senate: "voted NO on SB 3, standing with veterans, small businesses, and 62% of Texans who support legal THC. They fought Dan Patrick's criminalization scheme that would jail patients and destroy a $1.9 billion Texas industry."
            },
            3: { // Did not vote / Data unavailable
                house: "was ABSENT or their vote on SB 3 is not recorded here. Their stance on THC criminalization, which could betray veterans and kill 50,000 jobs, should be clarified. Silence in the face of extremism can be complicity.",
                senate: "was ABSENT or their vote on SB 3 is not recorded here. Their stance on THC criminalization, which could betray veterans and kill 50,000 jobs, should be clarified. Silence in the face of extremism can be complicity."
            }
        };
        
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const streetAddress = document.getElementById('streetAddress').value.trim();
            const city = document.getElementById('city').value.trim();
            const zip = document.getElementById('zip').value.trim();
            
            if (!zip) {
                showError('searchError', 'ZIP code is required.');
                return;
            }
            
            document.getElementById('hero').classList.add('compact');
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            hideError('searchError');
            
            // Attempt to save initial address data to Supabase
            if (supabase) {
                try {
                    const addressPayload = {
                        street_address: streetAddress,
                        city: city,
                        zip_code: zip,
                    };
                    console.log('Attempting to save initial address data:', addressPayload);
                    const { data: leadResult, error: leadError } = await addLead(addressPayload);
                        
                    if (leadError) {
                        console.error('Error saving initial address to Supabase:', leadError);
                        // Optionally show a non-critical error to user, or just log it.
                        // For now, we'll proceed with rep lookup even if this fails.
                        // showError('searchError', 'Could not save address entry. Please try again.');
                    } else if (leadResult && leadResult.id) {
                        currentLeadId = leadResult.id;
                        console.log('Initial address saved with Lead ID:', currentLeadId);
                    } else {
                        console.warn('No ID returned from addLead, or data is null.');
                    }
                } catch (err) {
                    console.error('Exception during Supabase addLead operation:', err);
                }
            } else {
                console.warn('Supabase client not available for saving initial address.');
            }
            
            // Proceed to fetch representatives
            try {
                const params = new URLSearchParams();
                if (streetAddress) params.append('address', streetAddress);
                if (city) params.append('city', city);
                params.append('zip', zip);
                params.append('DistType', 'A'); // A for All (House and Senate)
                
                const functionUrl = new URL('/.netlify/functions/match-address', window.location.origin);
                functionUrl.search = params.toString(); // Simpler way to add params
                
                console.log('Calling Netlify function for representatives:', functionUrl.toString());
                const response = await fetch(functionUrl.toString());
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: 'Failed to parse error response' }));
                    console.error('API Error Response:', errorData);
                    throw new Error(errorData.error || `Failed to fetch representatives. Status: ${response.status}`);
                }
                
                const data = await response.json();
                
                const houseData = data.House?.[0];
                const senateData = data.Senate?.[0];
                
                if (!houseData || !senateData) {
                    throw new Error('Could not find representative data for this address.');
                }
                
                displayResults(houseData, senateData);
                
            } catch (error) {
                console.error('Error fetching representatives:', error);
                showError('searchError', `Error finding representatives: ${error.message}. Please check the address or try again.`);
                document.getElementById('loading').style.display = 'none';
                // Optionally, display demo data if critical error like CORS, or just show error.
            }
        });
        
        function displayResults(houseData, senateData) {
            const houseDistrict = houseData.District;
            const senateDistrict = senateData.District;
            
            // Use default vote '3' (Did not vote/Unknown) if district not in loaded data
            const houseVote = houseVotes[houseDistrict] || 3; 
            const senateVote = senateVotes[senateDistrict] || 3;
            
            const houseMember = houseData.Member;
            const senateMember = senateData.Member;
            
            const formatPhoneForDisplay = (phone) => {
                if (!phone) return 'N/A';
                const cleaned = phone.replace(/\D/g, '');
                if (cleaned.length === 10) { // Standard US 10-digit phone
                    return `(${cleaned.substring(0,3)}) ${cleaned.substring(3,6)}-${cleaned.substring(6,10)}`;
                } else if (cleaned.length === 7 && houseMember.capitolPhone.startsWith('463')) { // Capitol extension style 463-xxxx
                     return `(512) ${cleaned.substring(0,3)}-${cleaned.substring(3,7)}`;
                }
                return phone; // Return original if not standard
            };

            const housePhoneDisplay = formatPhoneForDisplay(houseMember.capitolPhone);
            const senatePhoneDisplay = formatPhoneForDisplay(senateMember.capitolPhone);

            const houseTelLink = houseMember.capitolPhone ? `tel:${houseMember.capitolPhone.replace(/\D/g, '')}` : '#';
            const senateTelLink = senateMember.capitolPhone ? `tel:${senateMember.capitolPhone.replace(/\D/g, '')}` : '#';

            const repCardsHtml = `
                <div class="rep-card ${getVoteClass(houseVote)}">
                    <div class="rep-type">State Representative</div>
                    <div class="rep-name">${houseMember.formalName}</div>
                    <div class="district">House District ${houseDistrict}</div>
                    <div class="vote-status">
                        <span class="vote-icon">${getVoteIcon(houseVote)}</span>
                        ${getVoteText(houseVote)}
                    </div>
                    <p class="message">${houseMember.firstName || 'Your Representative'} ${houseMember.lastName || ''} ${messages[houseVote].house}</p>
                    <a href="${houseTelLink}" class="call-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                        <span>Call Your Representative</span>
                    </a>
                </div>
                
                <div class="rep-card ${getVoteClass(senateVote)}">
                    <div class="rep-type">State Senator</div>
                    <div class="rep-name">${senateMember.formalName}</div>
                    <div class="district">Senate District ${senateDistrict}</div>
                    <div class="vote-status">
                        <span class="vote-icon">${getVoteIcon(senateVote)}</span>
                        ${getVoteText(senateVote)}
                    </div>
                    <p class="message">${senateMember.firstName || 'Your Senator'} ${senateMember.lastName || ''} ${messages[senateVote].senate}</p>
                    <a href="${senateTelLink}" class="call-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path></svg>
                        <span>Call Your Senator</span>
                    </a>
                </div>
            `;
            
            document.getElementById('repCards').innerHTML = repCardsHtml;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
        
        function getVoteClass(vote) {
            switch(vote) {
                case 1: return 'voted-yes';
                case 2: return 'voted-no';
                default: return 'did-not-vote'; // Catches 3 and any other unexpected values
            }
        }
        
        function getVoteIcon(vote) {
            switch(vote) {
                case 1: return '✗'; // Against cannabis
                case 2: return '✓'; // For cannabis
                default: return '?';
            }
        }
        
        function getVoteText(vote) {
            switch(vote) {
                case 1: return 'Voted YES on THC Ban';
                case 2: return 'Voted NO on THC Ban';
                default: return 'Did Not Vote / Unknown';
            }
        }
        
        document.getElementById('signupForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const signupSubmitBtn = document.getElementById('signupSubmitBtn');
            signupSubmitBtn.disabled = true;
            signupSubmitBtn.textContent = 'Submitting...';
            hideError('signupError');

            const email = document.getElementById('signupEmail').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();

            if (!email && !phone) {
                showError('signupError', 'Please provide either an email or a phone number.');
                signupSubmitBtn.disabled = false;
                signupSubmitBtn.textContent = 'Help Us Fire These Reps';
                return;
            }

            if (!currentLeadId) {
                showError('signupError', 'Please search for your address first before signing up. This helps us associate your contact info correctly.');
                signupSubmitBtn.disabled = false;
                signupSubmitBtn.textContent = 'Help Us Fire These Reps';
                return;
            }

            if (!supabase) {
                showError('signupError', 'Service temporarily unavailable. Please try again later.');
                signupSubmitBtn.disabled = false;
                signupSubmitBtn.textContent = 'Help Us Fire These Reps';
                return;
            }
            
            try {
                const contactPayload = {};
                if (email) contactPayload.email = email;
                if (phone) contactPayload.phone = phone; // Pass raw phone, Supabase function handles it

                console.log('Attempting to update lead with contact info. Lead ID:', currentLeadId, 'Payload:', contactPayload);
                const { data, error } = await updateLead(currentLeadId, contactPayload);

                if (error) {
                    console.error('Error updating lead with contact info:', error);
                    showError('signupError', `Failed to save your contact information: ${error.message}. Please try again.`);
                } else {
                    console.log('Contact information updated successfully:', data);
                    alert('Thank you for signing up! Your contact information has been saved.');
                    document.getElementById('signupForm').reset(); // Clear the form
                }
            } catch (err) {
                console.error('Exception during Supabase updateLead operation:', err);
                showError('signupError', 'An unexpected error occurred. Please try again.');
            } finally {
                signupSubmitBtn.disabled = false;
                signupSubmitBtn.textContent = 'Help Us Fire These Reps';
            }
        });
        
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.style.display = 'block';
            }
        }
        
        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }
        
        // Privacy Modal Logic
        const privacyModal = document.getElementById('privacyModal');
        const privacyLinkFooter = document.getElementById('privacyLinkFooter');
        const closeModalButton = document.getElementById('closePrivacyModal');

        if (privacyLinkFooter) {
            privacyLinkFooter.onclick = function(e) {
                e.preventDefault();
                if (privacyModal) privacyModal.style.display = 'block';
            }
        }
        if (closeModalButton) {
            closeModalButton.onclick = function() {
                if (privacyModal) privacyModal.style.display = 'none';
            }
        }
        window.onclick = function(event) {
            if (event.target == privacyModal) {
                if (privacyModal) privacyModal.style.display = 'none';
            }
        }
        
        // Dynamic hook text for hero subtitle
        const hooks = [
            "safe\u00A0pain\u00A0relief",
            "safe\u00A0adult\u00A0recreation",
            "your\u00A0health\u00A0and\u00A0wellness",
            "personal\u00A0liberty",
            "safe\u00A0and\u00A0legal\u00A0THC"
        ];
        let currentHookIndex = 0;
        const thcHookElement = document.getElementById('thc-hook');

        if (thcHookElement) {
            const cycleHooks = () => {
                thcHookElement.style.opacity = 0;
                setTimeout(() => {
                    thcHookElement.textContent = hooks[currentHookIndex];
                    thcHookElement.style.opacity = 1;
                    currentHookIndex = (currentHookIndex + 1) % hooks.length; // Loop through hooks
                    setTimeout(cycleHooks, currentHookIndex === 0 ? 2500 : 1000); // Pause longer on the last hook
                }, 300);
            };
            setTimeout(cycleHooks, 500);
        }
    </script>
</body>
</html>