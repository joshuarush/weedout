<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weed Out Bad Reps! - Hold Politicians Accountable for the Texas THC Ban</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Animated background with darker green */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(76, 175, 80, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(76, 175, 80, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(76, 175, 80, 0.12) 0%, transparent 50%);
            z-index: -1;
            animation: floatBackground 20s ease-in-out infinite;
        }
        
        @keyframes floatBackground {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.05); }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px 20px;
            transition: all 0.6s ease;
        }
        
        .hero.compact {
            min-height: auto;
            padding: 60px 20px 40px;
        }
        
        h1 {
            font-size: clamp(3rem, 9vw, 6rem);
            font-weight: 900;
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            animation: glow 2s ease-in-out infinite alternate;
            text-shadow: 0 0 40px rgba(76, 175, 80, 0.6);
        }
        
        #thc-hook {
            display: inline;
            color: #4CAF50;
            font-weight: 700;
            padding: 0 2px;
            position: relative;
            transition: opacity 0.3s ease-in-out;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px rgba(76, 175, 80, 0.5)); }
            to { filter: drop-shadow(0 0 40px rgba(76, 175, 80, 0.8)); }
        }
        
        .subtitle {
            font-size: clamp(1.3rem, 3.5vw, 2rem);
            color: #b0b0b0;
            margin-bottom: 50px;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.3s;
            font-weight: 600;
            letter-spacing: -0.5px;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Search Form - Centered */
        .search-form {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards 0.5s;
            transition: all 0.3s ease;
            margin: 0 auto;
        }
        
        .search-form:hover {
            border-color: rgba(76, 175, 80, 0.5);
            box-shadow: 0 25px 70px rgba(76, 175, 80, 0.15);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #4CAF50;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        input:focus {
            outline: none;
            border-color: #4CAF50;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        
        .submit-btn {
            display: inline-block;
            background: #4CAF50;
            color: #fff;
            padding: 18px 35px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5);
        }
        
        /* Results Section */
        .results {
            display: none;
            padding: 60px 20px;
            opacity: 0;
            animation: fadeIn 0.8s ease forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .rep-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 50px;
        }
        
        .rep-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .rep-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, transparent, #4CAF50, transparent);
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .rep-card.voted-yes {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(239, 68, 68, 0.05);
        }
        
        .rep-card.voted-yes::before {
            background: linear-gradient(90deg, transparent, #ef4444, transparent);
        }
        
        .rep-card.voted-no {
            border-color: rgba(76, 175, 80, 0.4);
            background: rgba(76, 175, 80, 0.08);
        }
        
        .rep-card.did-not-vote {
            border-color: rgba(251, 191, 36, 0.3);
            background: rgba(251, 191, 36, 0.05);
        }
        
        .rep-card.did-not-vote::before {
            background: linear-gradient(90deg, transparent, #fbbf24, transparent);
        }
        
        .rep-type {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .rep-name {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .district {
            font-size: 16px;
            color: #888;
            margin-bottom: 20px;
        }
        
        .vote-status {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .vote-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .voted-yes .vote-status { color: #ef4444; }
        .voted-yes .vote-icon { background: #ef4444; color: white; }
        
        .voted-no .vote-status { color: #4CAF50; }
        .voted-no .vote-icon { background: #4CAF50; color: white; }
        
        .did-not-vote .vote-status { color: #fbbf24; }
        .did-not-vote .vote-icon { background: #fbbf24; color: black; }
        
        .message {
            margin-bottom: 20px;
            line-height: 1.6;
            opacity: 0.9;
        }
        
        .call-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: #4CAF50;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .call-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.5);
        }
        
        /* Action Section */
        .action-section {
            background: rgba(76, 175, 80, 0.08);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-top: 50px;
        }
        
        .action-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .signup-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .signup-form .form-group {
            margin-bottom: 15px;
        }
        
        /* Footer */
        .footer {
            padding: 40px 20px;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 80px;
            font-size: 14px;
            color: #666;
        }
        
        .privacy-link {
            color: #4CAF50;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }
        
        .privacy-link:hover {
            opacity: 0.8;
        }
        
        /* Loading State */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(76, 175, 80, 0.2);
            border-top-color: #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error Message */
        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        
        /* Privacy Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-content {
            max-width: 800px;
            margin: 50px auto;
            background: #1a1a1a;
            border-radius: 20px;
            padding: 40px;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: #666;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .close-modal:hover {
            color: #fff;
        }
    </style>
</head>
<body>
    <div class="hero" id="hero">
        <div class="container">
            <h1>Weed Out Bad Reps!</h1>
            <p class="subtitle">Your Texas state representatives just voted to take away your right to&nbsp;<span id="thc-hook" style="transition: opacity 0.3s ease-in-out;">safe and legal THC</span><br><br><i>How did your representatives vote?</i></p>
            
            <form class="search-form" id="searchForm">
                <div class="form-group">
                    <label for="streetAddress">Street Address</label>
                    <input type="text" id="streetAddress" placeholder="420 Main St">
                </div>
                
                <div class="form-group">
                    <label for="city">City</label>
                    <input type="text" id="city" placeholder="Austin">
                </div>
                
                <div class="form-group">
                    <label for="zip">ZIP Code <span style="color: #ef4444;">*</span></label>
                    <input type="text" id="zip" placeholder="78701" required>
                </div>
                
                <div class="error" id="searchError"></div>
                
                <button type="submit" class="submit-btn" id="submitBtn">See How Your Reps Voted</button>
            </form>
        </div>
    </div>
    
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Finding your representatives...</p>
    </div>
    
    <div class="results" id="results">
        <div class="container">
            <div class="rep-cards" id="repCards"></div>
            
            <div class="action-section">
                <h2 class="action-title">Join the Fight to Restore Our Rights</h2>
                <p>Sign up to get updates, learn about upcoming events, and find out how you can help hold these politicians accountable.<br></p>
                
                <form id="signupForm" class="signup-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="signupEmail">Email Address<br></label>
                            <input type="email" id="signupEmail" name="signupEmail" placeholder="you@example.com" required>
                        </div>
                        <div class="form-group">
                            <label for="signupPhone">Phone Number (Optional)</label>
                            <input type="tel" id="signupPhone" name="signupPhone" placeholder="(555) 123-4567">
                        </div>
                    </div>
                    <div class="error" id="signupError"></div>
                    <button type="submit" class="submit-btn">Help Us Fire These Reps</button>
                </form>
            </div>
        </div>
    </div>
    
    <footer class="footer">
        <p>Paid for by Texans for a Texan Texas PAC</p>
        <p><a href="#" class="privacy-link" onclick="showPrivacy(); return false;">Privacy Policy</a></p>
    </footer>
    
    <!-- Privacy Policy Modal -->
    <div class="modal" id="privacyModal">
        <div class="modal-content">
            <span class="close-modal" onclick="hidePrivacy()">&times;</span>
            <h2 style="color: #4CAF50; margin-bottom: 20px;">Privacy Policy</h2>
            <p style="line-height: 1.8; color: #ccc;">
                <strong>Texans for a Texan Texas PAC Privacy Policy</strong><br><br>
                
                <strong>Information We Collect:</strong><br>
                We collect the information you provide when using our website, including your address, email address, and phone number (if provided).<br><br>
                
                <strong>How We Use Your Information:</strong><br>
                - To identify your state representatives and senators<br>
                - To provide you with information about your representatives' voting records<br>
                - To send you updates about policy reform and political campaign efforts in Texas<br>
                - To mobilize grassroots support and fundraising for political candidates<br><br>
                
                <strong>Data Security:</strong><br>
                We implement appropriate security measures to protect your personal information. Your data is stored securely.<br><br>
                
                <strong>Your Rights:</strong><br>
                You may request to view, update, or delete your personal information at any time by contacting Texans for a Texan Texas PAC.<br><br>
                
                <strong>Contact:</strong><br>
                For questions about this privacy policy, please contact Texans for a Texan Texas PAC.
            </p>
        </div>
    </div>

    <!-- Add Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="/supabase.js"></script>
    
    <script>
        // Representative voting data
        // Format: { districtNumber: voteType }
        // 1 = Voted YES on banning THC (bad)
        // 2 = Voted NO on banning THC (good)
        // 3 = Did not vote
        
        // Load vote data from JSON file
        let houseVotes = {};
        let senateVotes = {};
        
        // Fetch and process the vote data
        fetch('voteValues.json')
            .then(response => response.json())
            .then(data => {
                // Process the data to separate house and senate votes
                data.forEach(item => {
                    if (item.chamber === 'H') {
                        houseVotes[item.district] = item.vote;
                    } else if (item.chamber === 'S') {
                        senateVotes[item.district] = item.vote;
                    }
                });
                
                // After data is loaded, initialize the map
                initializeMap();
            })
            .catch(error => {
                console.error('Error loading vote data:', error);
                // Fallback to initialize map even if data loading fails
                initializeMap();
            });
        
        // 1 = Voted YES on banning THC (bad)
        // 2 = Voted NO on banning THC (good)
        // 3 = Did not vote
        
        // Messages for different vote types
        const messages = {
            1: {
                house: "voted YES on SB 3 to criminalize THC and destroy 50,000 Texas jobs. They sided with Dan Patrick's extreme agenda over veterans who rely on THC for pain relief and PTSD. Now Texans face jail time for products that were legal yesterday.",
                senate: "voted YES on SB 3 to criminalize THC and destroy 50,000 Texas jobs. They sided with Dan Patrick's extreme agenda over veterans who rely on THC for pain relief and PTSD. Now Texans face jail time for products that were legal yesterday."
            },
            2: {
                house: "voted NO on SB 3, standing with veterans, small businesses, and 62% of Texans who support legal THC. They fought Dan Patrick's criminalization scheme that would jail patients and destroy a $1.9 billion Texas industry.",
                senate: "voted NO on SB 3, standing with veterans, small businesses, and 62% of Texans who support legal THC. They fought Dan Patrick's criminalization scheme that would jail patients and destroy a $1.9 billion Texas industry."
            },
            3: {
                house: "was ABSENT when Texas needed leadership on SB 3. Their silence let Dan Patrick criminalize THC, betray veterans, and kill 50,000 jobs. Cowardice in the face of extremism is complicity.",
                senate: "was ABSENT when Texas needed leadership on SB 3. Their silence let Dan Patrick criminalize THC, betray veterans, and kill 50,000 jobs. Cowardice in the face of extremism is complicity."
            }
        };
        
        // Form submission handler
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const streetAddress = document.getElementById('streetAddress').value;
            const city = document.getElementById('city').value;
            const zip = document.getElementById('zip').value;
            
            if (!zip) {
                showError('searchError', 'ZIP code is required');
                return;
            }
            
            // Hide hero, show loading
            document.getElementById('hero').classList.add('compact');
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            hideError('searchError');
            
            try {
                // Build API URL
                const params = new URLSearchParams();
                if (streetAddress) params.append('Address', streetAddress);
                if (city) params.append('City', city);
                params.append('Zip', zip);
                params.append('DistType', 'A');
                
                // Make the actual API call through Netlify function
                const functionUrl = new URL('/.netlify/functions/match-address', window.location.origin);
                
                // Add parameters to URL
                if (streetAddress) functionUrl.searchParams.append('address', streetAddress);
                if (city) functionUrl.searchParams.append('city', city);
                functionUrl.searchParams.append('zip', zip);
                functionUrl.searchParams.append('DistType', 'A');
                
                console.log('Calling function URL:', functionUrl.toString());
                const response = await fetch(functionUrl.toString());
                const data = await response.json();
                
                if (!response.ok) {
                    console.error('API Error:', data);
                    throw new Error(data.error || 'Failed to fetch representatives');
                }
                
                // Extract house and senate information
                const houseData = data.House?.[0];
                const senateData = data.Senate?.[0];
                
                if (!houseData || !senateData) {
                    throw new Error('Could not find representatives for this address');
                }
                
                displayResults(houseData, senateData);
                
            } catch (error) {
                console.error('Error:', error);
                
                // If CORS error or other issue, use proxy or show message
                if (error.message.includes('fetch')) {
                    showError('searchError', 'Due to browser security, you may need to use a proxy server or backend API. For demo purposes, showing sample data.');
                    
                    // Demo fallback
                    const demoHouseData = {
                        District: 51,
                        Member: {
                            formalName: "Representative Maria Luisa \"Lulu\" Flores",
                            capitolPhone: "5124630674",
                            emailAddress: "district51.flores@house.texas.gov"
                        }
                    };
                    
                    const demoSenateData = {
                        District: 21,
                        Member: {
                            formalName: "Senator Judith Zaffirini",
                            capitolPhone: "5124630121",
                            emailAddress: "Judith.Zaffirini@senate.texas.gov"
                        }
                    };
                    
                    displayResults(demoHouseData, demoSenateData);
                } else {
                    showError('searchError', 'Error finding representatives. Please try again.');
                    document.getElementById('loading').style.display = 'none';
                }
            }
        });
        
        function displayResults(houseData, senateData) {
            const houseDistrict = houseData.District;
            const senateDistrict = senateData.District;
            const houseVote = houseVotes[houseDistrict] || 3;
            const senateVote = senateVotes[senateDistrict] || 3;
            
            const houseMember = houseData.Member;
            const senateMember = senateData.Member;
            
            // Get phone numbers from the API response
            let housePhone = houseMember.capitolPhone || '';
            let formattedHousePhone = '';
            
            // Format house phone number if it exists
            if (housePhone) {
                const cleaned = housePhone.replace(/\D/g, '');
                const match = cleaned.match(/^(\d{3})(\d{3})(\d{4})$/);
                if (match) {
                    housePhone = `(${match[1]}) ${match[2]}-${match[3]}`;
                    formattedHousePhone = `Call ${houseMember.formalName} Now`;
                }
            } else {
                housePhone = '512-463-4630';
                formattedHousePhone = `Call ${houseMember.formalName} Now`;
            }
            
            let senatePhone = senateMember.capitolPhone || '';
            let formattedSenatePhone = '';
            
            // Format senate phone number if it exists
            if (senatePhone) {
                const cleaned = senatePhone.replace(/\D/g, '');
                const match = cleaned.match(/^(\d{3})(\d{3})(\d{4})$/);
                if (match) {
                    senatePhone = `(${match[1]}) ${match[2]}-${match[3]}`;
                    formattedSenatePhone = `Call ${senateMember.formalName} Now`;
                }
            } else {
                senatePhone = '512-463-4630';
                formattedSenatePhone = `Call ${senateMember.formalName} Now`;
            }
            
            const repCardsHtml = `
                <div class="rep-card ${getVoteClass(houseVote)}">
                    <div class="rep-type">State Representative</div>
                    <p class="rep-phone"><a href="tel:${housePhone.replace(/-/g, '')}">${formattedHousePhone}</a></p>
                    <div class="rep-name">${houseMember.formalName}</div>
                    <div class="district">House District ${houseDistrict}</div>
                    <div class="vote-status">
                        <span class="vote-icon">${getVoteIcon(houseVote)}</span>
                        ${getVoteText(houseVote)}
                    </div>
                    <p class="message">${houseMember.firstName} ${houseMember.lastName} ${messages[houseVote].house}</p>
                    <a href="tel:${housePhone.replace(/-/g, '')}" class="call-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        <span>Call Your Representative</span>
                    </a>
                </div>
                
                <div class="rep-card ${getVoteClass(senateVote)}">
                    <div class="rep-type">State Senator</div>
                    <p class="rep-phone"><a href="tel:${senatePhone.replace(/-/g, '')}">${formattedSenatePhone}</a></p>
                    <div class="rep-name">${senateMember.formalName}</div>
                    <div class="district">Senate District ${senateDistrict}</div>
                    <div class="vote-status">
                        <span class="vote-icon">${getVoteIcon(senateVote)}</span>
                        ${getVoteText(senateVote)}
                    </div>
                    <p class="message">${senateMember.firstName} ${senateMember.lastName} ${messages[senateVote].senate}</p>
                    <a href="tel:${senatePhone.replace(/-/g, '')}" class="call-btn">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        <span>Call Your Senator</span>
                    </a>
                </div>
            `;
            
            document.getElementById('repCards').innerHTML = repCardsHtml;
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
            
            // Smooth scroll to results
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
        
        function getVoteClass(vote) {
            switch(vote) {
                case 1: return 'voted-yes';
                case 2: return 'voted-no';
                case 3: return 'did-not-vote';
            }
        }
        
        function getVoteIcon(vote) {
            switch(vote) {
                case 1: return '✗';
                case 2: return '✓';
                case 3: return '?';
            }
        }
        
        function getVoteText(vote) {
            switch(vote) {
                case 1: return 'Voted YES on THC Ban';
                case 2: return 'Voted NO on THC Ban';
                case 3: return 'Did Not Vote';
            }
        }
        
        // Signup form handler
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('signupEmail').value;
            const phone = document.getElementById('signupPhone').value;
            const zip = document.getElementById('zip').value;
            const streetAddress = document.getElementById('streetAddress').value;
            const city = document.getElementById('city').value;
            
            // Store in localStorage for now (upgrade to Supabase for production)
            const signupData = {
                email,
                phone,
                address: { streetAddress, city, zip },
                timestamp: new Date().toISOString()
            };
            
            try {
                // Get existing signups
                const existingSignups = JSON.parse(localStorage.getItem('thcSignups') || '[]');
                existingSignups.push(signupData);
                localStorage.setItem('thcSignups', JSON.stringify(existingSignups));
                
                // Clear form and show success
                document.getElementById('signupForm').reset();
                alert('Thanks for signing up! We\'ll be in touch soon.');
                
            } catch (error) {
                showError('signupError', 'Error saving your information. Please try again.');
            }
        });
        
        // Error handling
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }
        
        function hideError(elementId) {
            document.getElementById(elementId).style.display = 'none';
        }
        
        // Initialize map/data
        function initializeMap() {
            // Function called after vote data is loaded
            console.log('Vote data loaded:', { houseVotes, senateVotes });
            // No specific map initialization needed - data is ready to use when user searches
        }
        
        // Privacy modal
        function showPrivacy() {
            document.getElementById('privacyModal').style.display = 'block';
        }
        
        function hidePrivacy() {
            document.getElementById('privacyModal').style.display = 'none';
        }
        
        // Close modal on outside click
        window.onclick = function(event) {
            const modal = document.getElementById('privacyModal');
            if (event.target == modal) {
                hidePrivacy();
            }
        }
        
        // Dynamic hook text for hero subtitle
        const hooks = [
            "safe&nbsp;pain&nbsp;relief",
            "safe&nbsp;adult&nbsp;recreation",
            "your&nbsp;health&nbsp;and&nbsp;wellness",
            "personal&nbsp;liberty",
            "safe&nbsp;and&nbsp;legal&nbsp;THC" // Final hook
        ];
        let currentHookIndex = 0;
        const thcHookElement = document.getElementById('thc-hook');

        if (thcHookElement) {
            const cycleHooks = () => {
                thcHookElement.style.opacity = 0;
                setTimeout(() => {
                    if (currentHookIndex < hooks.length) { // Ensure we don't go out of bounds
                        thcHookElement.textContent = hooks[currentHookIndex];
                        thcHookElement.style.opacity = 1;
                        currentHookIndex++;
                        if (currentHookIndex < hooks.length) { // If not the last hook, set timeout for next change
                            setTimeout(cycleHooks, 1000); // Change every 1 second
                        }
                    } // If currentHookIndex is already at hooks.length, it means the last hook is set and animation stops.
                }, 300); // Fade out/in duration
            };
            setTimeout(cycleHooks, 500); // Start after a brief delay
        }
    </script>
</body>
</html>